<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool Suite | Dashboard</title>
    <style>
        :root { --neon: #00ff88; --bg: #0f0f0f; --card: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 40px; }
        h1 { text-align: center; font-size: 2.5rem; letter-spacing: 2px; color: var(--neon); }
        .container { max-width: 1000px; margin: 0 auto; }
        .section-title { border-bottom: 2px solid #333; margin: 40px 0 20px; padding-bottom: 10px; color: #aaa; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: var(--card); border: 1px solid #333; border-radius: 12px; padding: 20px; 
                text-decoration: none; color: white; transition: 0.3s; display: block; }
        .card:hover { border-color: var(--neon); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,255,136,0.1); }
        .card h3 { margin: 0 0 10px 0; color: var(--neon); }
        .card p { font-size: 0.9rem; color: #ccc; margin: 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>PROJECT COLLAGE</h1>

        <div class="section-title">Counter-Strike 2</div>
        <div class="grid">
            <a href="cs2/econ-calc.html" class="card">
                <h3>Economy Calculator</h3>
                <p>Track enemy loss bonuses and predicts their next buy round.</p>
            </a>
        </div>

        <div class="section-title">Swimming</div>
        <div class="grid">
            <a href="swimming/pace-conv.html" class="card">
                <h3>Pace Converter</h3>
                <p>Convert Short Course Yards to Long Course Meters instantly.</p>
            </a>
        </div>

        <div class="section-title">First Car</div>
        <div class="grid">
            <a href="cars/inspections.html" class="card">
                <h3>Buyer's Checklist</h3>
                <p>Interactive guide for inspecting a used vehicle before purchase.</p>
            </a>
        </div>
        <div class="section-title">Uploaded Pages</div>
        <div class="grid" id="uploadedGrid">
            <!-- Uploaded pages will be populated here -->
        </div>
            <div style="margin-top:30px; text-align:center;">
                <button id="openUploader" style="background:var(--neon); color:#001; border:none; padding:10px 18px; border-radius:8px; cursor:pointer; font-weight:600;">Upload New Page</button>
            </div>
        </div>
</body>
    <div id="uploaderModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:9999;">
        <div style="background:#0b0b0b; color:#fff; padding:18px; border-radius:10px; width:min(900px,95%); max-height:90vh; overflow:auto; border:1px solid #222;">
            <h2 style="margin-top:0; color:var(--neon);">Paste HTML for new page</h2>
            <div style="display:flex; gap:12px; margin-bottom:8px; align-items:center;">
                <label style="min-width:80px; color:#ccc;">Filename</label>
                <input id="newFilename" placeholder="example.html" style="flex:1; padding:8px; border-radius:6px; border:1px solid #333; background:#111; color:#fff;">
            </div>
            <textarea id="newContent" placeholder="Paste full HTML here" style="width:100%; height:320px; padding:12px; background:#070707; color:#ddd; border:1px solid #222; border-radius:8px;"></textarea>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
                <button id="cancelUpload" style="background:#222; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer;">Cancel</button>
                <button id="submitUpload" style="background:var(--neon); color:#001; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-weight:700;">Save Page</button>
            </div>
            <div id="uploadMessage" style="margin-top:10px; color:#9f9; display:none;"></div>
        </div>
    </div>

    <script>
    (function(){
        const openBtn = document.getElementById('openUploader');
        const modal = document.getElementById('uploaderModal');
        const cancelBtn = document.getElementById('cancelUpload');
        const submitBtn = document.getElementById('submitUpload');
        const filenameInput = document.getElementById('newFilename');
        const contentInput = document.getElementById('newContent');
        const msg = document.getElementById('uploadMessage');

        openBtn.addEventListener('click', ()=>{
            modal.style.display = 'flex';
            filenameInput.focus();
        });
        cancelBtn.addEventListener('click', ()=>{ modal.style.display='none'; msg.style.display='none'; });

        function sanitizeFilename(name){
            if(!name) return '';
            name = name.replace(/\\/g, '/');
            name = name.split('/').pop();
            if(!/\.html?$/.test(name)) name = name + '.html';
            return name;
        }

        submitBtn.addEventListener('click', async ()=>{
            const fname = sanitizeFilename(filenameInput.value.trim());
            const content = contentInput.value;
            if(!fname){ alert('Please provide a filename.'); return; }
            if(!content){ alert('Please paste HTML content.'); return; }
            msg.style.display='none';

            // Try saving via local uploader server first
            try{
                const res = await fetch('/upload', {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ filename: fname, content })
                });
                const j = await res.json();
                if(res.ok){
                    msg.style.color = '#9f9'; msg.style.display='block'; msg.textContent = 'Saved to ' + j.path + ' — open it in your browser.';
                } else {
                    msg.style.color = '#f99'; msg.style.display='block'; msg.textContent = j.error || 'Upload failed.';
                }
            } catch(e){
                // Fallback: offer download
                const blob = new Blob([content], {type:'text/html'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = fname;
                document.body.appendChild(link);
                link.click();
                link.remove();
                msg.style.color = '#ffb'; msg.style.display='block'; msg.textContent = 'No local server detected — downloaded the file instead.';
            }
        });
    })();
    </script>
    <script>
    (async function(){
        try{
            const res = await fetch('/pages/list.json');
            if(!res.ok) return;
            const list = await res.json();
            const grid = document.getElementById('uploadedGrid');
            if(!grid || !Array.isArray(list)) return;
            grid.innerHTML = '';
            list.forEach(f => {
                const a = document.createElement('a');
                a.href = '/pages/' + encodeURIComponent(f);
                a.className = 'card';
                const h = document.createElement('h3');
                h.textContent = f;
                const p = document.createElement('p');
                p.textContent = 'Uploaded page';
                a.appendChild(h);
                a.appendChild(p);
                grid.appendChild(a);
            });
        }catch(e){}
    })();
    </script>
</html>
